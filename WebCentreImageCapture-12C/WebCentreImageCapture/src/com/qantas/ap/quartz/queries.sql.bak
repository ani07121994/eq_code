TIMESTAMP_CHECK_QUERY=\
select value from ap_properties_table where name='IMAGING_UPDATE_LAST_UPDATE_TIMESTAMP'

TIMESTAMP_INSERT_QUERY=\
insert into ap_properties_table values('IMAGING_UPDATE_LAST_UPDATE_TIMESTAMP', ?)

TIMESTAMP_UPDATE_QUERY=\
update ap_properties_table set value=? where name='IMAGING_UPDATE_LAST_UPDATE_TIMESTAMP'


EQFILES_QUERY=\
select * from ap_invoice_table where invoice_number=? and supplier_number=? and site_id=? and org_id=? and image_url=?


EBS_QUERY=\
SELECT ai.invoice_num \
      ,ai.invoice_id \
      ,as1.segment1 supplier_number \
      ,ass.vendor_site_id site_id \
      ,ai.org_id \
      ,ai.attribute15 image_url \
      ,decode(ai.cancelled_date \
             ,NULL \
             ,decode(ai.payment_status_flag \
                    ,'Y' \
                    ,'PAID' \
                    ,decode(hist.response \
                           ,NULL \
                           ,'CREATED' \
                           ,hist.response)) \
             ,'CANCELLED') invoice_status \
      ,hist.approver_name pending_with_approved_by \
      ,hist.last_update_date action_date \
  FROM apps.ap_invoices_all ai \
      ,apps.ap_suppliers as1 \
      ,apps.ap_supplier_sites_all ass \
      ,(SELECT * \
          FROM (SELECT rank() over(PARTITION BY invoice_id ORDER BY aha.invoice_id, aha.last_update_date DESC, aha.response DESC) sl_no \
                      ,aha.* \
                  FROM apps.ap_inv_aprvl_hist_all aha) \
         WHERE sl_no = 1) hist \
 WHERE ai.attribute12 LIKE '%IMGPROCESS' \
   AND ai.SOURCE LIKE 'P2P%' \
   AND ai.vendor_id = as1.vendor_id \
   AND ass.vendor_id = as1.vendor_id \
   AND ass.vendor_site_id = ai.vendor_site_id \
   AND ai.invoice_id = hist.invoice_id(+) \
   AND (ai.last_update_date >= to_date(?, 'YYYY-MM-DD HH24:MI:ss') OR \
       hist.last_update_date >= to_date(?, 'YYYY-MM-DD HH24:MI:ss') ) \
   AND (ai.last_update_date < to_date(?, 'YYYY-MM-DD HH24:MI:ss') OR \
       hist.last_update_date < to_date(?, 'YYYY-MM-DD HH24:MI:ss') ) \
UNION ALL \
SELECT ai.invoice_num \
      ,ai.invoice_id \
      ,as1.segment1 supplier_number \
      ,ass.vendor_site_id site_id \
      ,ai.org_id \
      ,ai.attribute15 image_url \
      ,decode(status \
             ,'REJECTED' \
             ,'INTERFACE REJECTED' \
             ,NULL \
             ,'NEW' \
             ,status) \
      ,NULL last_actioned_by \
      ,NULL last_action_date \
  FROM apps.ap_invoices_interface ai \
      ,apps.ap_suppliers          as1 \
      ,apps.ap_supplier_sites_all ass \
 WHERE ai.attribute12 LIKE '%IMGPROCESS' \
   AND ai.SOURCE LIKE 'P2P%' \
   AND ai.vendor_id = as1.vendor_id \
   AND ass.vendor_id = as1.vendor_id \
   AND ass.vendor_site_id = ai.vendor_site_id \
   AND nvl(status,'NEW') <> 'PROCESSED'